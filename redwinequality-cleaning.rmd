---
title: 'Práctica 2: Limpieza y análisis de datos'
author: 'Elisabeth Anna López Simpson y Jesús Antonio Blay Tamarit'
date: '`r format(Sys.Date(),"%e de %B %Y")`'
output:
  html_document:
    highlight: default
    number_sections: yes
    theme: cosmo
    toc: yes
    toc_depth: 2
  pdf_document:
    highlight: zenburn
    toc: yes
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## 0. Carga del dataset y de los paquetes de R necesarios
```{r echo=TRUE, message=FALSE, warning=FALSE}
# Cargamos los paquetes de R que vamos a usar
library(ggplot2)
library(dplyr)
library(gridExtra)
# Cargamos el fichero de datos
wine <- read.csv('winequality-red.csv', header=TRUE)
```
## 1. Descripción del dataset. 

### ¿Por qué es importante y qué pregunta/problema pretende responder?

El dataset contiene distintas observaciones de vino tinto y para cada observación se recogen 12 atributos. Los 11 primeros atributos son mediciones físicoquímicas (de tipo numérico), mientras que el último atributo (la variable de interés), es una clasificación sensorial de la calidad del vino, en una escala de 0 a 10 (esta variable sólo puede tomar valores enteros). 

Nuestro objetivo es estudiar como influyen las 11 variables de entrada en la calidad del vino y cuáles de ellas son más decisivas en una mayor calidad. 

Variables de entrada:

1 - *fixed acidity*: mide la acidez fija debida a los ácidos orgánicos presentes en la uva, como los ácidos tartárico, málico y cítrico.
2 - *volatile acidity*: mide el ácido acético presente en el vino por la fermentación. Puede dar lugar a sensación de olor a vinagre como consecuencia de fermentos dañinos.
3 - *citric acid*: acidificante para corregir la acidez en mostos y vinos.
4 - *residual sugar*: mide la cantidad de azúcar presente tras la fermentación.
5 - *chlorides*: mide la concentración de iones de cloruro, generalmente indicativa de la presencia de cloruro de sodio, que aumenta la salinidad de un vino, lo que puede contribuir o restar valor al sabor y la calidad general del vino.
6 - *free sulfur dioxide*: mide la cantidad de dioxido de azufre o SO2 que está libre en el vino.
7 - *total sulfur dioxide*: mide el dióxido de azufre total (TSO2), es decir, la porción de SO2 que está libre en el vino más la porción que está unida a otras sustancias químicas en el vino, como aldehídos, pigmentos o azúcares.
8 - *density*: mide la densidad del vino, en g/cm3
9 - *pH*: mide la acidez del vino.
10 - *sulphates*: aditivo para el vino que actúa como antimicrobiano y antioxidante. Puede contribuir a los niveles de dióxido de azufre.
11 - *alcohol*: porcentaje de alcohol en el vino.

Variable de interés: 

12 - *quality*: clasificación sensorial de la calidad del vino, en una escala de 0 a 10.


Comenzamos con un primer vistazo a las distintas variables.

```{r echo=TRUE, message=FALSE, warning=FALSE}
# Verificamos la dimensión y la estructura del conjunto de datos 
dim(wine)
summary(wine)
```
Tenemos 1599 observaciones. Vemos también que efectivamente todas las variables son de tipo numérico.

## 2. Integración y selección de los datos de interés a analizar.

De las 11 variables de entrada, a priori desconocemos como afecta cada una y su peso a la calidad final del vino, por lo que para empezar vamos a estudiar la distribución de cada una de estas variables en función de la calidad del vino (cuyos valores, en nuestra muestra, observamos que van del 3 al 8).

```{r echo=TRUE, message=FALSE, warning=FALSE}
# Distribución de fixed.acidity, volatile.acidity, citric.acid y residual.sugar en función de la calidad del vino      
v1 <- ggplot(data=wine, aes(x=factor(quality), y=fixed.acidity, color=quality)) +   geom_boxplot()
v2 <- ggplot(data=wine, aes(x=factor(quality), y=volatile.acidity, color=quality)) + geom_boxplot()
v3 <- ggplot(data=wine, aes(x=factor(quality), y=citric.acid, color=quality)) + geom_boxplot()
v4 <- ggplot(data=wine, aes(x=factor(quality), y=residual.sugar, color=quality)) + geom_boxplot()

grid.arrange(v1, v2, v3, v4, ncol = 2, nrow = 2)
```
```{r echo=TRUE, message=FALSE, warning=FALSE}
# Distribución de chlorides, free.sulfur.dioxide, total.sulfur.dioxide y density en función de la calidad del vino               
v5 <- ggplot(data=wine, aes(x=factor(quality), y=chlorides, color=quality)) + geom_boxplot()
v6 <- ggplot(data=wine, aes(x=factor(quality), y=free.sulfur.dioxide, color=quality)) + geom_boxplot()
v7 <- ggplot(data=wine, aes(x=factor(quality), y=total.sulfur.dioxide, color=quality)) + geom_boxplot()
v8 <- ggplot(data=wine, aes(x=factor(quality), y=density, color=quality)) + geom_boxplot()

grid.arrange(v5, v6, v7, v8, ncol = 2, nrow = 2)
```
```{r echo=TRUE, message=FALSE, warning=FALSE}
# Distribución de pH, sulphates, y alcohol en función de la calidad del vino                                      
v9 <- ggplot(data=wine, aes(x=factor(quality), y=pH, color=quality)) + geom_boxplot()
v10 <- ggplot(data=wine, aes(x=factor(quality), y=sulphates, color=quality)) + geom_boxplot()
v11 <- ggplot(data=wine, aes(x=factor(quality), y=alcohol, color=quality)) + geom_boxplot()

grid.arrange(v9, v10, v11, ncol = 2, nrow = 2)
```

A primera vista es difícil sacar conclusiones, pero estos datos ya nos ofrecen un primer punto de partida a partir del cuál comenzar nuestro análisis:

Según muestran los *boxplots* anteriores, parece existir una correlación negativa entre la variable ***quality*** y las variables ***volatile.acidity***, ***chlorides *** y  ***pH***, que por otra parte sería completamente coherente con la descripción de estas variables, detallada en el punto 1 (descripción del dataset). También observamos una aparente relación inversa entre ***quality*** y ***density***, que a priori no parece tan obvia y que estudiaremos posteriormente.

Igualmente, también parece existir una relación positiva entre la variable ***quality*** y las variables ***citric.acid ***,  ***sulphates *** y  ***alcohol***.

Analizaremos estas posibles correlaciones más adelante. En todo caso, por ahora no podemos descartar ninguna de las variables ya que todas ellas corresponden a distintas mediciones de factores que podrían ser determinantes en la calidad del vino. 

Sin embargo, nos interesaremos especialmente por analizar como afectan a la calidad del vino las variables ***density***, ***citric.acid ***,  ***sulphates *** y  ***alcohol***, así como también el ***pH*** (acidez total del vino) y el ***total sulfur dioxide*** (dióxido de azufre total).


## 3. Limpieza de los datos.
### 3.1. ¿Los datos contienen ceros o elementos vacíos? ¿Cómo gestionarías cada uno de estos casos?

Antes de comenzar con el análisis, comprobamos la existencia de vacíos o nulos.

```{r echo=TRUE, message=FALSE, warning=FALSE}

# Estadísticas de valores vacíos
colSums(is.na(wine))
colSums(wine=='')

# Estadísticas de valores cero
colSums(wine==0)
```

No existen valores vacíos (en caso de que los hubiera, no deberíamos prescindir de la observación, pero hubiese sido recomendable saberlo en su caso, para ignorar estos valores en las distintas funciones que usaremos en nuestro análisis).

Por otra parte, sí existen valores nulos, concretamente 132 en la variable *citric.acid*, pero entendemos que son valores legítimos y correctos, ya que sus valores posibles, como hemos visto con la función ***summary***, oscilan entre 0 y 1. Por tanto, vamos a dar por buenos estos valores nulos.

### 3.2. Identificación y tratamiento de valores extremos.







## 4. Análisis de los datos.
### 4.1. Selección de los grupos de datos que se quieren analizar/comparar (planificación de los análisis a aplicar).

Sabemos que la calidad del vino se mide en una escala de 0 a 10. Sin embargo, hemos visto que de nuestras 1.599 observaciones, la mejor nota obtenida es 8, situándose la gran mayoría entre 5 y 6 (rango intercuartílico). Observamos con más detalle la distribución de todas las puntuaciones.

```{r echo=TRUE, message=FALSE, warning=FALSE}
# Verificamos la dimensión y la estructura del conjunto de datos 
ggplot(data=wine, aes(x=quality)) + geom_bar()
```

### 4.2. Comprobación de la normalidad y homogeneidad de la varianza.
### 4.3. Aplicación de pruebas estadísticas para comparar los grupos de datos. En función de los datos y el objetivo del estudio, aplicar pruebas de contraste de hipótesis, correlaciones, regresiones, etc. Aplicar al menos tres métodos de análisis diferentes.

## 5. Representación de los resultados a partir de tablas y gráficas.

## 6. Resolución del problema. A partir de los resultados obtenidos, ¿cuáles son las conclusiones? ¿Los resultados permiten responder al problema?

## 7. Código: Hay que adjuntar el código, preferiblemente en R, con el que se ha realizado la limpieza, análisis y representación de los datos. Si lo preferís, también podéis trabajar en Python.

